apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "gitea.fullname" . }}-scripts
  labels:
    {{- include "gitea.labels" . | nindent 4 }}
data:
  init.sh: |
    #!/bin/bash
    if [ ! -f /data/gitea/conf/app.ini ]; then
      mkdir -p /data/gitea/conf
      mkdir -p /data/gitea/lfs
      mkdir -p /data/git
      mkdir -p /data/git/gitea-repositories
      mkdir -p /data/log
      cp /config/app.ini /data/gitea/conf/app.ini
      chmod u+rw /data/gitea/conf/app.ini

      /app/gitea/gitea admin user create --username root --password admin --email test@test.com --admin
    fi
